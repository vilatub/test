#!/usr/bin/env python3
"""
Phase 6: Explainable AI - Part 5 (Final)
Add: Decision Tree Visualization, Conclusions
"""

import json

# –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π notebook
notebook_path = '/home/user/test/notebooks/phase6_explainable_ai/01_explainable_ai_xai.ipynb'
with open(notebook_path, 'r', encoding='utf-8') as f:
    notebook = json.load(f)

cells = notebook['cells']

# ============================================================================
# DECISION TREE VISUALIZATION
# ============================================================================

cells.append({
    "cell_type": "markdown",
    "metadata": {},
    "source": [
        "---\n",
        "\n",
        "## üå≥ –ß–∞—Å—Ç—å 6: Decision Tree Visualization\n",
        "\n",
        "### Model-Specific Interpretability\n",
        "\n",
        "**Decision Trees** - inherently interpretable –º–æ–¥–µ–ª–∏:\n",
        "- –ö–∞–∂–¥–æ–µ —Ä–µ—à–µ–Ω–∏–µ - —ç—Ç–æ simple if-then rule\n",
        "- –ü—É—Ç—å –æ—Ç root –¥–æ leaf –æ–±—ä—è—Å–Ω—è–µ—Ç prediction\n",
        "- –ú–æ–∂–Ω–æ –≤–∏–∑—É–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≤–µ—Å—å process\n",
        "\n",
        "**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**\n",
        "- ‚úÖ **Complete transparency:** –≤–∏–¥–∏–º –≤—Å–µ –ø—Ä–∞–≤–∏–ª–∞\n",
        "- ‚úÖ **Easy to explain:** –º–æ–∂–Ω–æ –æ–±—ä—è—Å–Ω–∏—Ç—å –ª—é–±–æ–º—É\n",
        "- ‚úÖ **No preprocessing needed:** —Ä–∞–±–æ—Ç–∞–µ—Ç —Å categorical features\n",
        "\n",
        "**Trade-off:**\n",
        "- ‚ö†Ô∏è **Accuracy vs Interpretability:**\n",
        "  - Shallow tree: interpretable, –Ω–æ –º–µ–Ω–µ–µ —Ç–æ—á–Ω–∞—è\n",
        "  - Deep tree: —Ç–æ—á–Ω–∞—è, –Ω–æ —Å–ª–æ–∂–Ω–∞—è –¥–ª—è –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏–∏\n",
        "  - Random Forest / XGBoost: –µ—â—ë —Ç–æ—á–Ω–µ–µ, –Ω–æ black box (–Ω—É–∂–µ–Ω SHAP)\n",
        "\n",
        "**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**\n",
        "- ‚úÖ **High-stakes decisions:** –º–µ–¥–∏—Ü–∏–Ω–∞, –∫—Ä–µ–¥–∏—Ç—ã (–Ω—É–∂–Ω–∞ –ø–æ–ª–Ω–∞—è –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å)\n",
        "- ‚úÖ **Regulatory compliance:** –∫–æ–≥–¥–∞ —Ç—Ä–µ–±—É–µ—Ç—Å—è –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ –∫–∞–∂–¥–æ–≥–æ –ø—Ä–∞–≤–∏–ª–∞\n",
        "- ‚úÖ **Knowledge extraction:** –ø–æ–Ω—è—Ç—å domain logic –∏–∑ –¥–∞–Ω–Ω—ã—Ö\n",
        "\n",
        "---\n"
    ]
})

cells.append({
    "cell_type": "code",
    "execution_count": None,
    "metadata": {},
    "outputs": [],
    "source": [
        "print(\"=\" * 70)\n",
        "print(\"DECISION TREE VISUALIZATION\")\n",
        "print(\"=\" * 70)\n",
        "\n",
        "# –û–±—É—á–∞–µ–º –ø—Ä–æ—Å—Ç—É—é Decision Tree –¥–ª—è –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏–∏\n",
        "print(\"\\nTraining interpretable Decision Tree (max_depth=4)...\")\n",
        "dt = DecisionTreeClassifier(\n",
        "    max_depth=4,  # –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –≥–ª—É–±–∏–Ω—É –¥–ª—è interpretability\n",
        "    min_samples_split=100,\n",
        "    min_samples_leaf=50,\n",
        "    random_state=42\n",
        ")\n",
        "\n",
        "dt.fit(X_train_scaled, y_train)\n",
        "dt_pred = dt.predict(X_test_scaled)\n",
        "\n",
        "# –ú–µ—Ç—Ä–∏–∫–∏\n",
        "dt_accuracy = accuracy_score(y_test, dt_pred)\n",
        "dt_f1 = f1_score(y_test, dt_pred)\n",
        "dt_auc = roc_auc_score(y_test, dt.predict_proba(X_test_scaled)[:, 1])\n",
        "\n",
        "print(f\"\\n‚úÖ Decision Tree trained\")\n",
        "print(f\"Accuracy: {dt_accuracy:.4f}\")\n",
        "print(f\"F1-Score: {dt_f1:.4f}\")\n",
        "print(f\"ROC AUC: {dt_auc:.4f}\")\n",
        "print(f\"\\n–¢–æ—á–Ω–æ—Å—Ç—å –Ω–∏–∂–µ, —á–µ–º —É XGBoost/RF, –Ω–æ –¥–µ—Ä–µ–≤–æ –ø–æ–ª–Ω–æ—Å—Ç—å—é interpretable!\")\n"
    ]
})

cells.append({
    "cell_type": "code",
    "execution_count": None,
    "metadata": {},
    "outputs": [],
    "source": [
        "# –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è Decision Tree\n",
        "fig, ax = plt.subplots(figsize=(25, 15))\n",
        "\n",
        "plot_tree(\n",
        "    dt,\n",
        "    feature_names=feature_cols,\n",
        "    class_names=['<=50K', '>50K'],\n",
        "    filled=True,\n",
        "    rounded=True,\n",
        "    ax=ax,\n",
        "    fontsize=10,\n",
        "    proportion=True  # –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–æ–ø–æ—Ä—Ü–∏–∏ –≤–º–µ—Å—Ç–æ –∞–±—Å–æ–ª—é—Ç–Ω—ã—Ö —á–∏—Å–µ–ª\n",
        ")\n",
        "\n",
        "plt.title('Decision Tree Visualization (max_depth=4)', fontsize=16, fontweight='bold', pad=20)\n",
        "plt.tight_layout()\n",
        "plt.show()\n",
        "\n",
        "print(\"\\nüìä –ö–∞–∫ —á–∏—Ç–∞—Ç—å –¥–µ—Ä–µ–≤–æ:\")\n",
        "print(\"- –ö–∞–∂–¥—ã–π —É–∑–µ–ª: —É—Å–ª–æ–≤–∏–µ split (e.g., capital-gain <= 0.5)\")\n",
        "print(\"- gini: impurity (0 = pure, 0.5 = 50/50)\")\n",
        "print(\"- samples: –¥–æ–ª—è samples –≤ —ç—Ç–æ–º —É–∑–ª–µ\")\n",
        "print(\"- value: [proportion class 0, proportion class 1]\")\n",
        "print(\"- class: predicted class (—Ü–≤–µ—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç majority class)\")\n",
        "print(\"\\n–û—Ä–∞–Ω–∂–µ–≤—ã–π = <=50K, –°–∏–Ω–∏–π = >50K\")\n"
    ]
})

cells.append({
    "cell_type": "code",
    "execution_count": None,
    "metadata": {},
    "outputs": [],
    "source": [
        "# –¢–µ–∫—Å—Ç–æ–≤–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª\n",
        "print(\"\\n\" + \"=\" * 70)\n",
        "print(\"DECISION RULES (TEXT FORMAT)\")\n",
        "print(\"=\" * 70)\n",
        "\n",
        "tree_rules = export_text(dt, feature_names=feature_cols)\n",
        "print(tree_rules)\n",
        "\n",
        "print(\"\\nüí° –ü—Ä–∏–º–µ—Ä—ã –ø—Ä–∞–≤–∏–ª:\")\n",
        "print(\"- IF capital-gain > 0.5 AND ... ‚Üí Predicted: >50K\")\n",
        "print(\"- IF age <= 0.3 AND education-num <= 0.2 ‚Üí Predicted: <=50K\")\n",
        "print(\"\\n–≠—Ç–∏ –ø—Ä–∞–≤–∏–ª–∞ –º–æ–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å –±–∏–∑–Ω–µ—Å—É / —Ä–µ–≥—É–ª—è—Ç–æ—Ä–∞–º!\")\n"
    ]
})

cells.append({
    "cell_type": "code",
    "execution_count": None,
    "metadata": {},
    "outputs": [],
    "source": [
        "# Feature Importance –∏–∑ Decision Tree\n",
        "dt_importance = dt.feature_importances_\n",
        "\n",
        "importance_df = pd.DataFrame({\n",
        "    'Feature': feature_cols,\n",
        "    'Importance': dt_importance\n",
        "}).sort_values('Importance', ascending=False)\n",
        "\n",
        "# –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è\n",
        "fig, ax = plt.subplots(figsize=(10, 6))\n",
        "\n",
        "top_n = 12\n",
        "ax.barh(\n",
        "    range(top_n),\n",
        "    importance_df.head(top_n)['Importance'],\n",
        "    alpha=0.8,\n",
        "    color='steelblue'\n",
        ")\n",
        "\n",
        "ax.set_yticks(range(top_n))\n",
        "ax.set_yticklabels(importance_df.head(top_n)['Feature'])\n",
        "ax.set_xlabel('Feature Importance (Gini)', fontsize=12)\n",
        "ax.set_title('Decision Tree Feature Importance', fontsize=14, fontweight='bold')\n",
        "ax.invert_yaxis()\n",
        "ax.grid(axis='x', alpha=0.3)\n",
        "\n",
        "plt.tight_layout()\n",
        "plt.show()\n",
        "\n",
        "print(\"\\nüéØ –¢–æ–ø-5 –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –≤ Decision Tree:\")\n",
        "print(importance_df.head(5).to_string(index=False))\n"
    ]
})

# ============================================================================
# COMPREHENSIVE SUMMARY
# ============================================================================

cells.append({
    "cell_type": "markdown",
    "metadata": {},
    "source": [
        "---\n",
        "\n",
        "## üìã –ß–∞—Å—Ç—å 7: Comprehensive Summary & Best Practices\n",
        "\n",
        "### –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö XAI –º–µ—Ç–æ–¥–æ–≤\n",
        "\n",
        "| –ú–µ—Ç–æ–¥ | Scope | Speed | Theory | Use Case |\n",
        "|-------|-------|-------|--------|----------|\n",
        "| **SHAP** | Global + Local | ‚ö†Ô∏è Medium (TreeSHAP fast) | ‚úÖ Game theory | Production, —Ç—Ä–µ–±—É–µ—Ç—Å—è consistency |\n",
        "| **LIME** | Local only | ‚úÖ Fast | ‚ùå Heuristic | Quick ad-hoc explanations |\n",
        "| **PDP** | Global | ‚úÖ Fast | ‚úÖ Solid | Global feature effects |\n",
        "| **Permutation Importance** | Global | ‚ö†Ô∏è Medium | ‚úÖ Solid | True feature importance |\n",
        "| **Gini Importance** | Global | ‚úÖ Very fast | ‚ö†Ô∏è Biased | Quick check (tree models) |\n",
        "| **Decision Tree Viz** | Global | ‚úÖ Fast | ‚úÖ Complete | Full transparency |\n",
        "| **Attention Weights** | Local | ‚úÖ Fast | ‚ö†Ô∏è Debatable | Transformers only |\n",
        "\n",
        "---\n",
        "\n",
        "### üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –≤—ã–±–æ—Ä—É –º–µ—Ç–æ–¥–∞\n",
        "\n",
        "#### 1. **Production ML System (High Stakes)**\n",
        "- ‚úÖ **Primary:** SHAP (—Ç–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏ –æ–±–æ—Å–Ω–æ–≤–∞–Ω, consistent)\n",
        "- ‚úÖ **Secondary:** Permutation Importance (global view)\n",
        "- ‚úÖ **Fairness:** Demographic Parity, Equal Opportunity\n",
        "- ‚úÖ **Documentation:** Model cards, fairness reports\n",
        "\n",
        "**–ü—Ä–∏–º–µ—Ä:** Credit scoring, healthcare diagnostics, hiring\n",
        "\n",
        "#### 2. **Quick Prototyping / Research**\n",
        "- ‚úÖ **LIME** (fast local explanations)\n",
        "- ‚úÖ **PDP** (global trends)\n",
        "- ‚úÖ **Feature Importance** (quick check)\n",
        "\n",
        "**–ü—Ä–∏–º–µ—Ä:** Kaggle competition, exploratory analysis\n",
        "\n",
        "#### 3. **Regulatory Compliance (Full Transparency)**\n",
        "- ‚úÖ **Decision Tree** visualization\n",
        "- ‚úÖ **Rule extraction**\n",
        "- ‚úÖ **Linear models** —Å coefficient interpretation\n",
        "- ‚ö†Ô∏è –í–æ–∑–º–æ–∂–Ω–æ –ø—Ä–∏–¥—ë—Ç—Å—è –∂–µ—Ä—Ç–≤–æ–≤–∞—Ç—å accuracy\n",
        "\n",
        "**–ü—Ä–∏–º–µ—Ä:** Regulated industries (banking, insurance), government\n",
        "\n",
        "#### 4. **Deep Learning / Transformers**\n",
        "- ‚úÖ **DeepSHAP** –∏–ª–∏ **GradientSHAP**\n",
        "- ‚úÖ **Attention visualization** (—Å –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ—Å—Ç—å—é)\n",
        "- ‚úÖ **Integrated Gradients**\n",
        "- ‚úÖ **Saliency Maps** (–¥–ª—è images/text)\n",
        "\n",
        "**–ü—Ä–∏–º–µ—Ä:** NLP, computer vision, time series with Transformers\n",
        "\n",
        "---\n",
        "\n",
        "### ‚öñÔ∏è Fairness Best Practices\n",
        "\n",
        "1. **Identify Sensitive Attributes:**\n",
        "   - Gender, race, age, disability status, etc.\n",
        "   - Legal requirements vary by jurisdiction\n",
        "\n",
        "2. **Choose Fairness Metric(s):**\n",
        "   - **Demographic Parity:** —Ä–∞–≤–Ω—ã–µ positive rates\n",
        "   - **Equal Opportunity:** —Ä–∞–≤–Ω—ã–µ TPR (—á–∞—Å—Ç–æ preferred)\n",
        "   - **Calibration:** equal calibration –ø–æ –≥—Ä—É–ø–ø–∞–º\n",
        "   - ‚ö†Ô∏è **–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ** —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç—å –≤—Å–µ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ!\n",
        "\n",
        "3. **Measure Fairness:**\n",
        "   - –ù–∞ **test set** (–Ω–µ –Ω–∞ train!)\n",
        "   - –î–ª—è **–≤—Å–µ—Ö** sensitive groups\n",
        "   - **Before** –∏ **after** mitigation\n",
        "\n",
        "4. **Bias Mitigation:**\n",
        "   - **Pre-processing:** reweighting, resampling\n",
        "   - **In-processing:** fairness constraints in loss\n",
        "   - **Post-processing:** threshold optimization\n",
        "\n",
        "5. **Documentation:**\n",
        "   - **Model Cards** (Google best practice)\n",
        "   - Fairness metrics in production dashboard\n",
        "   - Regular audits (quarterly/yearly)\n",
        "\n",
        "6. **Continuous Monitoring:**\n",
        "   - Fairness –º–æ–∂–µ—Ç drift —Å–æ –≤—Ä–µ–º–µ–Ω–µ–º\n",
        "   - Data distribution changes ‚Üí fairness changes\n",
        "   - Monitor –≤ production!\n",
        "\n",
        "---\n",
        "\n",
        "### üöÄ Production Deployment Checklist\n",
        "\n",
        "**Before deploying ML model:**\n",
        "\n",
        "- [ ] **Interpretability:**\n",
        "  - [ ] SHAP values computed –¥–ª—è test set\n",
        "  - [ ] Global feature importance documented\n",
        "  - [ ] Local explanation API available\n",
        "  - [ ] PDP plots generated –¥–ª—è —Ç–æ–ø–æ–≤—ã—Ö features\n",
        "\n",
        "- [ ] **Fairness:**\n",
        "  - [ ] Sensitive attributes identified\n",
        "  - [ ] Fairness metrics measured (Demographic Parity, Equal Opportunity)\n",
        "  - [ ] Bias mitigation applied (if needed)\n",
        "  - [ ] Fairness report –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω\n",
        "\n",
        "- [ ] **Documentation:**\n",
        "  - [ ] Model card created\n",
        "  - [ ] Training data –æ–ø–∏—Å–∞–Ω–∞ (source, biases, limitations)\n",
        "  - [ ] Evaluation metrics –ø–æ –≤—Å–µ–º groups\n",
        "  - [ ] Known limitations –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã\n",
        "  - [ ] Ethical considerations discussed\n",
        "\n",
        "- [ ] **Monitoring:**\n",
        "  - [ ] Dashboard –¥–ª—è monitoring fairness –≤ production\n",
        "  - [ ] Alerts –Ω–∞ drift –≤ fairness metrics\n",
        "  - [ ] Logging –¥–ª—è SHAP values (sample)\n",
        "\n",
        "- [ ] **Legal/Regulatory:**\n",
        "  - [ ] Legal review completed\n",
        "  - [ ] GDPR compliance (–ø—Ä–∞–≤–æ –Ω–∞ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ)\n",
        "  - [ ] Industry-specific regulations checked\n",
        "\n",
        "---\n"
    ]
})

cells.append({
    "cell_type": "markdown",
    "metadata": {},
    "source": [
        "### üìö Key Takeaways\n",
        "\n",
        "#### 1. **Interpretability is NOT Optional**\n",
        "- –†–µ–≥—É–ª–∏—Ä—É–µ–º—ã–µ –∏–Ω–¥—É—Å—Ç—Ä–∏–∏ —Ç—Ä–µ–±—É—é—Ç –æ–±—ä—è—Å–Ω–µ–Ω–∏–π (GDPR, FDA, etc.)\n",
        "- Stakeholders —Ö–æ—Ç—è—Ç –ø–æ–Ω–∏–º–∞—Ç—å, –∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –º–æ–¥–µ–ª—å\n",
        "- Debugging: interpretability –ø–æ–º–æ–≥–∞–µ—Ç –Ω–∞–π—Ç–∏ bugs –∏ bias\n",
        "\n",
        "#### 2. **SHAP - Gold Standard**\n",
        "- –¢–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏ –æ–±–æ—Å–Ω–æ–≤–∞–Ω (Shapley values)\n",
        "- Consistent, local + global\n",
        "- TreeSHAP –æ—á–µ–Ω—å fast –¥–ª—è tree-based –º–æ–¥–µ–ª–µ–π\n",
        "- **Use SHAP –≤ production**\n",
        "\n",
        "#### 3. **Different Methods, Different Insights**\n",
        "- **SHAP:** feature attribution (—Å–∫–æ–ª—å–∫–æ –∫–∞–∂–¥—ã–π –ø—Ä–∏–∑–Ω–∞–∫ –≤–Ω–æ—Å–∏—Ç)\n",
        "- **PDP:** global trends (–∫–∞–∫ –ø—Ä–∏–∑–Ω–∞–∫ –≤–ª–∏—è–µ—Ç –≤ —Å—Ä–µ–¥–Ω–µ–º)\n",
        "- **LIME:** quick local explanations\n",
        "- **Permutation:** true importance (handles correlations)\n",
        "- **–í—Å–µ –≤–º–µ—Å—Ç–µ** –¥–∞—é—Ç comprehensive understanding!\n",
        "\n",
        "#### 4. **Fairness ‚â† Equal Outcomes**\n",
        "- Fairness - —ç—Ç–æ –ø—Ä–æ equal treatment, –Ω–µ equal outcomes\n",
        "- –í—ã–±–æ—Ä fairness metric –∑–∞–≤–∏—Å–∏—Ç –æ—Ç use case –∏ –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤–∞\n",
        "- Trade-off: fairness vs accuracy (–∏–Ω–æ–≥–¥–∞ –Ω–µ–∏–∑–±–µ–∂–µ–Ω)\n",
        "- **Measure, mitigate, monitor**\n",
        "\n",
        "#### 5. **Accuracy vs Interpretability Trade-off**\n",
        "- Simple models (linear, shallow trees): interpretable, –Ω–æ –º–µ–Ω–µ–µ —Ç–æ—á–Ω—ã–µ\n",
        "- Complex models (deep learning, ensembles): —Ç–æ—á–Ω—ã–µ, –Ω–æ black box\n",
        "- **XAI methods** (SHAP, LIME) –ø–æ–∑–≤–æ–ª—è—é—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å complex models —Å –æ–±—ä—è—Å–Ω–µ–Ω–∏—è–º–∏\n",
        "- **Best of both worlds!**\n",
        "\n",
        "#### 6. **Documentation & Transparency**\n",
        "- Model cards - best practice –æ—Ç Google\n",
        "- –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å training data, biases, limitations\n",
        "- Transparency builds trust\n",
        "- –†–µ–≥—É–ª—è—Ç–æ—Ä—ã —Ç—Ä–µ–±—É—é—Ç –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é\n",
        "\n",
        "#### 7. **Continuous Monitoring**\n",
        "- Fairness –∏ interpretability –Ω–µ one-time tasks\n",
        "- Data drift ‚Üí fairness drift\n",
        "- Monitor –≤ production, —Ä–µ–≥—É–ª—è—Ä–Ω—ã–µ audits\n",
        "\n",
        "---\n",
        "\n",
        "### üîó –°–≤—è–∑—å —Å –¥—Ä—É–≥–∏–º–∏ —Ñ–∞–∑–∞–º–∏\n",
        "\n",
        "**Phase 6 –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∑–Ω–∞–Ω–∏—è –∏–∑:**\n",
        "- **Phase 1-2:** –ë–∞–∑–æ–≤—ã–µ –º–æ–¥–µ–ª–∏ (Logistic Regression, Neural Networks)\n",
        "- **Phase 3:** Ensemble methods (Random Forest, XGBoost) ‚Üí TreeSHAP\n",
        "- **Phase 4:** Transformers ‚Üí Attention visualization\n",
        "- **Phase 5:** Anomaly detection ‚Üí interpretable outliers\n",
        "\n",
        "**Phase 6 –≥–æ—Ç–æ–≤–∏—Ç –∫:**\n",
        "- **Phase 7:** Production & MLOps ‚Üí monitoring fairness, model cards\n",
        "\n",
        "---\n",
        "\n",
        "### üéì Real-World Impact\n",
        "\n",
        "**XAI —Å–ø–∞—Å–∞–µ—Ç –ø—Ä–æ–µ–∫—Ç—ã:**\n",
        "- **Amazon (2018):** Hiring AI –¥–∏—Å–∫—Ä–∏–º–∏–Ω–∏—Ä–æ–≤–∞–ª–∞ –∂–µ–Ω—â–∏–Ω ‚Üí –ø—Ä–æ–µ–∫—Ç –∑–∞–∫—Ä—ã—Ç\n",
        "  - ‚úÖ **Lesson:** Measure fairness before deployment!\n",
        "- **COMPAS:** Racial bias –≤ criminal justice\n",
        "  - ‚úÖ **Lesson:** Audit third-party models!\n",
        "- **Healthcare:** FDA —Ç—Ä–µ–±—É–µ—Ç –æ–±—ä—è—Å–Ω–µ–Ω–∏—è AI diagnoses\n",
        "  - ‚úÖ **Lesson:** Interpretability = regulatory requirement\n",
        "\n",
        "**XAI —Å–æ–∑–¥–∞—ë—Ç —Ü–µ–Ω–Ω–æ—Å—Ç—å:**\n",
        "- **–ö—Ä–µ–¥–∏—Ç–Ω—ã–π —Å–∫–æ—Ä–∏–Ω–≥:** –û–±—ä—è—Å–Ω–µ–Ω–∏–µ –æ—Ç–∫–∞–∑–∞ ‚Üí –∫–ª–∏–µ–Ω—Ç –∑–Ω–∞–µ—Ç, –∫–∞–∫ —É–ª—É—á—à–∏—Ç—å\n",
        "- **–ú–µ–¥–∏—Ü–∏–Ω–∞:** –í—Ä–∞—á –ø–æ–Ω–∏–º–∞–µ—Ç AI –¥–∏–∞–≥–Ω–æ–∑ ‚Üí –±–æ–ª—å—à–µ –¥–æ–≤–µ—Ä–∏—è\n",
        "- **Fraud detection:** –ê–Ω–∞–ª–∏—Ç–∏–∫ –≤–∏–¥–∏—Ç, –ø–æ—á–µ–º—É —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è suspicious ‚Üí –±—ã—Å—Ç—Ä–µ–µ —Ä–µ–∞–≥–∏—Ä—É–µ—Ç\n",
        "- **–ë–∏–∑–Ω–µ—Å insights:** SHAP –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç, –∫–∞–∫–∏–µ —Ñ–∞–∫—Ç–æ—Ä—ã –≤–ª–∏—è—é—Ç –Ω–∞ churn ‚Üí action plan\n",
        "\n",
        "---\n",
        "\n",
        "## üéâ Phase 6 Complete!\n",
        "\n",
        "**–í—ã —Ç–µ–ø–µ—Ä—å –∑–Ω–∞–µ—Ç–µ:**\n",
        "- ‚úÖ SHAP (TreeSHAP, KernelSHAP, DeepSHAP)\n",
        "- ‚úÖ LIME\n",
        "- ‚úÖ Partial Dependence Plots (PDP)\n",
        "- ‚úÖ Permutation Importance\n",
        "- ‚úÖ Fairness metrics (Demographic Parity, Equal Opportunity, Calibration)\n",
        "- ‚úÖ Bias mitigation strategies\n",
        "- ‚úÖ Decision Tree visualization\n",
        "- ‚úÖ Production best practices\n",
        "\n",
        "**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥: Phase 7 - Production & MLOps**\n",
        "- Model deployment (FastAPI, Docker, Cloud)\n",
        "- Monitoring (data drift, model drift, fairness drift)\n",
        "- CI/CD –¥–ª—è ML\n",
        "- Experiment tracking (MLflow, Weights & Biases)\n",
        "- –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ (DVC)\n",
        "\n",
        "---\n",
        "\n",
        "**üöÄ Ready for production-ready ML!**\n"
    ]
})

# –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ñ–∏–Ω–∞–ª—å–Ω—ã–π notebook
notebook['cells'] = cells

with open(notebook_path, 'w', encoding='utf-8') as f:
    json.dump(notebook, f, ensure_ascii=False, indent=1)

print(f'\\n‚úÖ Phase 6 notebook complete: {notebook_path}')
print(f'Total cells: {len(cells)}')
print('Decision Tree visualization and comprehensive conclusions added!')
print('')
print('üìä Phase 6 Summary:')
print('- Introduction & Setup (5 cells)')
print('- EDA & Preprocessing (5 cells)')
print('- Model Training (3 cells)')
print('- SHAP Analysis (15 cells)')
print('- LIME Analysis (4 cells)')
print('- PDP & Permutation Importance (6 cells)')
print('- Fairness Analysis (7 cells)')
print('- Decision Tree Visualization (5 cells)')
print('- Conclusions & Best Practices (3 cells)')
print('')
print('Total: 53 cells - Comprehensive Explainable AI & Fairness!')
